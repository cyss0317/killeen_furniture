<div data-controller="drawer">
  <!-- Backdrop (mobile only, fixed full-screen) -->
  <div data-drawer-target="backdrop"
       data-action="click->drawer#close"
       class="fixed inset-0 z-40 bg-black/60 opacity-0 pointer-events-none transition-opacity duration-300 md:hidden"
       aria-hidden="true"></div>

  <!-- Mobile drawer panel (slides in from right) -->
  <nav data-drawer-target="panel"
       class="fixed top-0 right-0 z-50 h-full w-72 bg-white flex flex-col shadow-2xl translate-x-full transition-transform duration-300 ease-in-out md:hidden"
       aria-modal="true"
       role="dialog"
       aria-label="Navigation menu">

    <!-- Drawer header -->
    <div class="h-16 flex items-center justify-between px-5 border-b border-gray-100 flex-shrink-0">
      <%= link_to root_path, class: "text-xl font-bold text-amber-800 tracking-tight", data: { action: "click->drawer#close" } do %>
        Warehouse Furniture
      <% end %>
      <button data-action="click->drawer#close"
              class="text-gray-400 hover:text-gray-700 p-1 rounded transition-colors"
              aria-label="Close menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <!-- Drawer scrollable body -->
    <div class="flex-1 overflow-y-auto py-4">
      <!-- Navigation links -->
      <div class="px-2">
        <%= link_to "Shop All", products_path,
            class: "flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-amber-50 hover:text-amber-800 rounded-lg transition-colors",
            data: { action: "click->drawer#close" } %>
        <% Category.root_categories.where.not(name: ["Ashley Furniture", "Generation Trade"]).limit(4).each do |category| %>
          <%= link_to category.name, category_path(category),
              class: "flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-amber-50 hover:text-amber-800 rounded-lg transition-colors",
              data: { action: "click->drawer#close" } %>
        <% end %>
        <p class="px-4 pt-3 pb-1 text-xs font-semibold text-gray-400 uppercase tracking-wide">Brands</p>
        <%= link_to "Ashley Furniture", brand_path("Ashley Furniture"),
            class: "flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-amber-50 hover:text-amber-800 rounded-lg transition-colors",
            data: { action: "click->drawer#close" } %>
        <%= link_to "Generation Trade", brand_path("Generation Trade"),
            class: "flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-amber-50 hover:text-amber-800 rounded-lg transition-colors",
            data: { action: "click->drawer#close" } %>
      </div>

      <div class="my-3 mx-4 border-t border-gray-100"></div>

      <!-- Utility: Search + Cart -->
      <div class="px-2">
        <%= link_to products_path,
            class: "flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-700 hover:bg-amber-50 hover:text-amber-800 rounded-lg transition-colors",
            data: { action: "click->drawer#close" } do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          Search
        <% end %>

        <%= link_to cart_path,
            class: "flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-700 hover:bg-amber-50 hover:text-amber-800 rounded-lg transition-colors",
            data: { action: "click->drawer#close" } do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
          </svg>
          Cart
          <% count = current_cart.total_items %>
          <% if count > 0 %>
            <span class="ml-auto bg-amber-700 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">
              <%= count %>
            </span>
          <% end %>
        <% end %>
      </div>

      <div class="my-3 mx-4 border-t border-gray-100"></div>

      <!-- Auth -->
      <div class="px-2">
        <% if user_signed_in? %>
          <p class="px-4 py-2 text-xs font-semibold text-gray-400 uppercase tracking-wide">
            <%= current_user.full_name %>
          </p>
          <%= link_to "My Account", account_profile_path,
              class: "flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-amber-50 hover:text-amber-800 rounded-lg transition-colors",
              data: { action: "click->drawer#close" } %>
          <%= link_to "My Orders", account_orders_path,
              class: "flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-amber-50 hover:text-amber-800 rounded-lg transition-colors",
              data: { action: "click->drawer#close" } %>
          <% if current_user.admin_or_above? %>
            <%= link_to "Admin Panel", admin_dashboard_path,
                class: "flex items-center px-4 py-3 text-sm font-medium text-amber-800 hover:bg-amber-50 rounded-lg transition-colors",
                data: { action: "click->drawer#close" } %>
          <% end %>
          <%= link_to "Sign Out", destroy_user_session_path,
              data: { turbo_method: :delete, action: "click->drawer#close" },
              class: "flex items-center px-4 py-3 text-sm font-medium text-gray-500 hover:bg-gray-50 hover:text-gray-700 rounded-lg transition-colors" %>
        <% else %>
          <%= link_to "Sign In", new_user_session_path,
              class: "flex items-center px-4 py-3 text-sm font-medium text-gray-700 hover:bg-amber-50 hover:text-amber-800 rounded-lg transition-colors",
              data: { action: "click->drawer#close" } %>
          <%= link_to "Create Account", new_user_registration_path,
              class: "mx-4 mt-1 block text-center text-sm font-medium bg-amber-800 text-white px-4 py-2.5 rounded-lg hover:bg-amber-900 transition-colors",
              data: { action: "click->drawer#close" } %>
        <% end %>
      </div>
    </div>
  </nav>

  <!-- Sticky header -->
  <header class="bg-white shadow-sm sticky top-0 z-30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">

        <!-- Logo (always visible) -->
        <%= link_to root_path, class: "flex items-center flex-shrink-0" do %>
          <span class="text-2xl font-bold text-amber-800 tracking-tight">Warehouse Furniture</span>
        <% end %>

        <!-- Desktop: nav + right actions â€” hidden entirely on mobile -->
        <div class="hidden md:flex items-center gap-8">
          <nav class="flex items-center space-x-6">
            <%= link_to "Shop All", products_path, class: "text-sm font-medium text-gray-700 hover:text-amber-800 transition-colors" %>
            <% Category.root_categories.where.not(name: ["Ashley Furniture", "Generation Trade"]).limit(4).each do |category| %>
              <%= link_to category.name, category_path(category), class: "text-sm font-medium text-gray-700 hover:text-amber-800 transition-colors" %>
            <% end %>
            <div class="relative" data-controller="dropdown">
              <button data-action="click->dropdown#toggle" class="flex items-center text-sm font-medium text-gray-700 hover:text-amber-800 transition-colors">
                Brands
                <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div data-dropdown-target="menu" class="hidden absolute left-0 mt-2 w-44 bg-white rounded-md shadow-lg border border-gray-100 py-1 z-50">
                <%= link_to "Ashley Furniture", brand_path("Ashley Furniture"), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-amber-800" %>
                <%= link_to "Generation Trade", brand_path("Generation Trade"), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-amber-800" %>
              </div>
            </div>
          </nav>

          <div class="flex items-center space-x-4">
            <!-- Search -->
            <%= link_to products_path, class: "text-gray-600 hover:text-amber-800 transition-colors" do %>
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            <% end %>

            <!-- Cart -->
            <%= link_to cart_path, class: "relative text-gray-600 hover:text-amber-800 transition-colors" do %>
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
              </svg>
              <%= render "shared/cart_badge", count: current_cart.total_items %>
            <% end %>

            <!-- Auth -->
            <% if user_signed_in? %>
              <div class="relative" data-controller="dropdown">
                <button data-action="click->dropdown#toggle" class="flex items-center text-sm font-medium text-gray-700 hover:text-amber-800 transition-colors">
                  <%= current_user.first_name %>
                  <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                <div data-dropdown-target="menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-100 py-1 z-50">
                  <%= link_to "My Account", account_profile_path, class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50" %>
                  <%= link_to "My Orders", account_orders_path, class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50" %>
                  <% if current_user.admin_or_above? %>
                    <div class="border-t border-gray-100 my-1"></div>
                    <%= link_to "Admin Panel", admin_dashboard_path, class: "block px-4 py-2 text-sm text-amber-800 font-medium hover:bg-gray-50" %>
                  <% end %>
                  <div class="border-t border-gray-100 my-1"></div>
                  <%= link_to "Sign Out", destroy_user_session_path,
                      data: { turbo_method: :delete },
                      class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50" %>
                </div>
              </div>
            <% else %>
              <%= link_to "Sign In", new_user_session_path, class: "text-sm font-medium text-gray-700 hover:text-amber-800 transition-colors" %>
              <%= link_to "Create Account", new_user_registration_path, class: "ml-2 text-sm font-medium bg-amber-800 text-white px-4 py-2 rounded-md hover:bg-amber-900 transition-colors" %>
            <% end %>
          </div>
        </div>

        <!-- Mobile: hamburger button only (right side) -->
        <button data-action="click->drawer#open"
                class="md:hidden p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"
                aria-label="Open menu"
                aria-expanded="false">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>

      </div>
    </div>
  </header>
</div>
