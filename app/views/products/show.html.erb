<% content_for :title, "#{@product.name} — Killeen Furniture" %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Breadcrumb -->
  <nav class="flex mb-6 text-sm" aria-label="Breadcrumb">
    <%= link_to "Home", root_path, class: "text-gray-400 hover:text-gray-600" %>
    <span class="mx-2 text-gray-300">/</span>
    <%= link_to "Shop", products_path, class: "text-gray-400 hover:text-gray-600" %>
    <span class="mx-2 text-gray-300">/</span>
    <span class="text-gray-900 font-medium"><%= @product.name %></span>
  </nav>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
    <!-- Images -->
    <div>
      <% if @product.images.attached? %>
        <div class="aspect-square bg-gray-100 rounded-xl overflow-hidden mb-4">
          <%= image_tag @product.primary_image.variant(resize_to_fill: [600, 600]),
              class: "w-full h-full object-cover",
              alt: @product.name,
              id: "main-product-image" %>
        </div>
        <% if @product.images.count > 1 %>
          <div class="grid grid-cols-4 gap-2">
            <% @product.images.each do |image| %>
              <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden cursor-pointer border-2 border-transparent hover:border-amber-500 transition-colors"
                   onclick="document.getElementById('main-product-image').src = '<%= url_for(image.variant(resize_to_fill: [600, 600])) %>'">
                <%= image_tag image.variant(resize_to_fill: [150, 150]), class: "w-full h-full object-cover", alt: @product.name %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% else %>
        <div class="aspect-square bg-gray-100 rounded-xl flex items-center justify-center">
          <svg class="w-24 h-24 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
        </div>
      <% end %>
    </div>

    <!-- Product Info -->
    <div>
      <% if @product.brand.present? %>
        <p class="text-sm text-amber-700 font-medium mb-2"><%= @product.brand %></p>
      <% end %>
      <h1 class="text-3xl font-bold text-gray-900 mb-2"><%= @product.name %></h1>
      <p class="text-sm text-gray-400 mb-4">SKU: <%= @product.sku %></p>

      <div class="flex items-baseline gap-3 mb-6">
        <span class="text-3xl font-bold text-gray-900"><%= number_to_currency(@product.selling_price) %></span>
      </div>

      <% if @product.short_description.present? %>
        <p class="text-gray-600 mb-6"><%= @product.short_description %></p>
      <% end %>

      <!-- Stock Status -->
      <div class="mb-6">
        <% if @product.in_stock? %>
          <span class="inline-flex items-center gap-1.5 text-green-700 bg-green-50 px-3 py-1 rounded-full text-sm font-medium">
            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
            In Stock (<%= @product.stock_quantity %> available)
          </span>
        <% else %>
          <span class="inline-flex items-center gap-1.5 text-red-600 bg-red-50 px-3 py-1 rounded-full text-sm font-medium">
            <span class="w-2 h-2 bg-red-400 rounded-full"></span>
            Out of Stock
          </span>
        <% end %>
      </div>

      <!-- Add to Cart -->
      <% if @product.in_stock? %>
        <%= form_with url: add_item_cart_path, method: :post, data: { turbo: true } do |f| %>
          <%= f.hidden_field :product_id, value: @product.id %>
          <div class="flex gap-4 mb-4">
            <div class="flex items-center border border-gray-300 rounded-md">
              <button type="button" onclick="this.nextElementSibling.value = Math.max(1, parseInt(this.nextElementSibling.value) - 1)"
                      class="px-3 py-2 text-gray-600 hover:text-gray-900 font-bold">−</button>
              <%= f.number_field :quantity, value: 1, min: 1, max: @product.stock_quantity,
                  class: "w-16 text-center border-0 focus:ring-0 text-sm font-medium", id: "qty-field" %>
              <button type="button" onclick="this.previousElementSibling.value = Math.min(<%= @product.stock_quantity %>, parseInt(this.previousElementSibling.value) + 1)"
                      class="px-3 py-2 text-gray-600 hover:text-gray-900 font-bold">+</button>
            </div>
            <%= f.submit "Add to Cart",
                class: "flex-1 bg-amber-800 text-white font-semibold py-3 px-6 rounded-md hover:bg-amber-900 transition-colors cursor-pointer text-center" %>
          </div>
        <% end %>
      <% end %>

      <!-- Product Details -->
      <div class="border-t border-gray-100 pt-6 space-y-3">
        <% if @product.material.present? %>
          <div class="flex text-sm">
            <span class="w-28 text-gray-500 font-medium">Material</span>
            <span class="text-gray-900"><%= @product.material %></span>
          </div>
        <% end %>
        <% if @product.color.present? %>
          <div class="flex text-sm">
            <span class="w-28 text-gray-500 font-medium">Color</span>
            <span class="text-gray-900"><%= @product.color %></span>
          </div>
        <% end %>
        <% if @product.dimensions.present? && @product.dimensions.any? %>
          <div class="flex text-sm">
            <span class="w-28 text-gray-500 font-medium">Dimensions</span>
            <span class="text-gray-900">
              <% d = @product.dimensions %>
              <%= [d["width"], d["height"], d["depth"]].compact.join(" × ") %>"
            </span>
          </div>
        <% end %>
        <% if @product.weight.present? %>
          <div class="flex text-sm">
            <span class="w-28 text-gray-500 font-medium">Weight</span>
            <span class="text-gray-900"><%= @product.weight %> lbs</span>
          </div>
        <% end %>
        <% if @product.category.present? %>
          <div class="flex text-sm">
            <span class="w-28 text-gray-500 font-medium">Category</span>
            <%= link_to @product.category.name, category_path(@product.category),
                class: "text-amber-800 hover:underline" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Full Description -->
  <% if @product.description.body.present? %>
    <div class="mt-12 prose max-w-none border-t border-gray-100 pt-8">
      <h2 class="text-xl font-bold text-gray-900 mb-4">Product Description</h2>
      <%= @product.description %>
    </div>
  <% end %>

  <!-- Related Products -->
  <% if @related.any? %>
    <section class="mt-16">
      <h2 class="text-xl font-bold text-gray-900 mb-6">You Might Also Like</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
        <% @related.each do |product| %>
          <%= render "products/product_card", product: product %>
        <% end %>
      </div>
    </section>
  <% end %>
</div>
