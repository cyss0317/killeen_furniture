<% content_for :title, "Orders" %>

<div class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-bold text-gray-900">Orders</h1>
  <div class="flex gap-2">
    <% [["All", nil], ["Pending", "pending"], ["Paid", "paid"], ["Scheduled", "scheduled_for_delivery"], ["Delivered", "delivered"]] .each do |label, status| %>
      <%= link_to label, admin_orders_path(status: status),
          class: "px-3 py-1.5 text-sm rounded-md font-medium transition-colors #{params[:status] == status ? 'bg-amber-800 text-white' : 'bg-white border border-gray-300 text-gray-700 hover:bg-gray-50'}" %>
    <% end %>
  </div>
</div>

<!-- Search -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6">
  <%= form_with url: admin_orders_path, method: :get, data: { turbo: false } do |f| %>
    <%= f.hidden_field :status, value: params[:status] %>
    <div class="flex gap-3">
      <%= f.search_field :q, value: params[:q], placeholder: "Search order number, customer name, email...",
          class: "border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500 flex-1" %>
      <%= f.submit "Search", class: "bg-gray-800 text-white text-sm px-4 py-2 rounded-md hover:bg-gray-700 cursor-pointer" %>
    </div>
  <% end %>
</div>

<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Order</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Zone</th>
        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">Status</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-100">
      <% @orders.each do |order| %>
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4">
            <%= link_to order.order_number, admin_order_path(order), class: "text-sm font-mono font-medium text-amber-700 hover:underline" %>
            <p class="text-xs text-gray-400"><%= order.order_items.count %> items</p>
          </td>
          <td class="px-6 py-4">
            <p class="text-sm font-medium text-gray-900"><%= order.customer_name %></p>
            <p class="text-xs text-gray-400"><%= order.customer_email %></p>
          </td>
          <td class="px-6 py-4 text-sm text-gray-600"><%= order.delivery_zone&.name || "â€”" %></td>
          <td class="px-6 py-4 text-sm font-semibold text-right"><%= number_to_currency(order.grand_total) %></td>
          <td class="px-6 py-4 text-center">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= status_badge_class(order.status) %>">
              <%= order.status.humanize %>
            </span>
          </td>
          <td class="px-6 py-4 text-sm text-gray-500"><%= order.created_at.strftime("%b %d, %Y") %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <% if @orders.empty? %>
    <div class="py-12 text-center text-gray-400 text-sm">No orders found</div>
  <% end %>
</div>

<% if @pagy.pages > 1 %>
  <div class="mt-6 flex justify-center"><%== pagy_nav(@pagy) %></div>
<% end %>
