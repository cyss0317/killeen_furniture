<% content_for :title, "Delivery Queue" %>

<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-2xl font-bold text-gray-900">Delivery Queue</h1>
    <p class="text-sm text-gray-500 mt-1">
      Your assigned orders
      <% if current_user.delivery_admin? %>â€” showing only your assignments<% end %>
    </p>
  </div>
</div>

<%# Status filter tabs %>
<div class="flex gap-2 mb-6 border-b border-gray-200 flex-wrap">
  <% [["All Active", ""], ["Scheduled", "scheduled_for_delivery"], ["Out for Delivery", "out_for_delivery"]].each do |label, value| %>
    <%= link_to label,
        delivery_orders_path(status: value.presence),
        class: "px-4 py-2 text-sm font-medium border-b-2 transition-colors #{
          params[:status].to_s == value ? 'border-amber-700 text-amber-800' : 'border-transparent text-gray-500 hover:text-gray-700'
        }" %>
  <% end %>
</div>

<% if @orders.empty? %>
  <div class="text-center py-16 text-gray-400">
    <p class="text-lg font-medium">No pending deliveries</p>
    <p class="text-sm mt-1">All caught up!</p>
  </div>
<% else %>
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
    <table class="min-w-full divide-y divide-gray-100">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Order</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Address</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Items</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
          <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        <% @orders.each do |order| %>
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4">
              <p class="text-sm font-mono font-medium text-gray-900"><%= order.order_number %></p>
              <p class="text-xs text-gray-400"><%= order.created_at.strftime("%b %d") %></p>
            </td>
            <td class="px-6 py-4">
              <p class="text-sm text-gray-900"><%= order.customer_name %></p>
              <p class="text-xs text-gray-400"><%= order.customer_phone %></p>
            </td>
            <td class="px-6 py-4">
              <p class="text-sm text-gray-700"><%= order.shipping_address_line %></p>
            </td>
            <td class="px-6 py-4 text-sm text-gray-600">
              <%= order.order_items.sum(:quantity) %> item(s)
            </td>
            <td class="px-6 py-4">
              <span class="px-2 py-1 rounded-full text-xs font-medium <%= status_badge_class(order.status) %>">
                <%= order.status.humanize %>
              </span>
            </td>
            <td class="px-6 py-4 text-right">
              <div class="flex justify-end gap-2">
                <%= link_to "View", delivery_order_path(order),
                    class: "text-sm text-amber-700 hover:text-amber-900 font-medium" %>
                <% if policy(order).mark_delivered? %>
                  <%= button_to "Mark Delivered", mark_delivered_delivery_order_path(order),
                      method: :patch,
                      class: "text-sm bg-green-600 text-white px-3 py-1 rounded-md hover:bg-green-700 cursor-pointer",
                      data: { confirm: "Mark order #{order.order_number} as delivered?" } %>
                <% end %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <% if @pagy.pages > 1 %>
    <div class="mt-6 flex justify-center">
      <%== @pagy.series_nav %>
    </div>
  <% end %>
<% end %>
